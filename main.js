(()=>{"use strict";const e=new class{constructor(){this.board=null,this.lists=null,this.task=null}init(){this.listenerAddCard(),this.board.addEventListener("click",this.remove)}bindToDOM(e){if(!(e instanceof HTMLElement))throw new Error("No board!");this.board=e,this.lists=this.board.querySelectorAll("ul"),this.task=this.board.querySelectorAll(".task")}remove(e){e.target.classList.contains("crest")&&e.target.closest("li")&&e.target.closest("li").remove()}listenerAddCard(){[...document.querySelectorAll(".add")].forEach((e=>{e.addEventListener("click",(t=>{const s=document.createElement("div");s.classList="textarea_div",s.innerHTML='\n              <textarea required class="textarea" cols="19" placeholder="New Task"></textarea>\n              <p class="add">+ Add another card</p>\n              <button class="crest">&#215</button>\n              ',t.target.replaceWith(s),s.addEventListener("click",(t=>{if(t.target.classList.contains("crest")&&s.replaceWith(e),t.target.classList.contains("add")&&""!==s.querySelector(".textarea").value){const r=this.addCard(s.querySelector(".textarea").value);t.target.closest(".col").querySelector("ul").append(r),s.replaceWith(e),this.task=this.board.querySelectorAll(".task")}}))}))}))}addCard(e){const t=document.createElement("li");return t.classList.add("task"),t.insertAdjacentHTML("beforeend",`<span>${e}</span><button class="crest">&#215</button>`),t}save(){const e={todo:[],inprogress:[],done:[]};return this.lists.forEach((t=>{t.querySelectorAll("li").forEach(((s,r)=>{e[t.getAttribute("data-category")][r]=s.querySelector("span").textContent}))})),e}load(e){this.lists.forEach((e=>{e.innerHTML=""})),Object.entries(e).forEach((([e,t])=>{t.forEach((t=>{this.board.querySelector(`[data-category="${e}"]`).insertAdjacentElement("beforeend",this.addCard(t))}))}))}};e.bindToDOM(document.querySelector(".board")),e.init();(new class{constructor(){this.board=null,this.drag=null,this.drop=null,this.x=null,this.y=null,this.elem=null,this.goal=null}init(){this.board=document.querySelector(".board"),this.board.addEventListener("mousedown",this.mousedown),this.board.addEventListener("mousemove",this.mousemove),this.board.addEventListener("mouseup",this.mouseup),this.board.addEventListener("mouseleave",this.mouseleave)}mousedown(e){e.target.closest(".task")&&!e.target.classList.contains("crest")&&(e.preventDefault(),this.drag=e.target.closest(".task"),this.drop=this.drag.cloneNode(!0),this.x=e.clientX-this.drag.getBoundingClientRect().left,this.y=e.clientY-this.drag.getBoundingClientRect().top,this.drop.style.width=`${this.drag.offsetWidth}px`,this.drop.classList.add("dragged"),document.querySelector(".board").appendChild(this.drop),this.drop.style.left=e.pageX-this.x+"px",this.drop.style.top=e.pageY-this.y+"px",this.drag.style.opacity=0,this.goal=document.createElement("li"),this.goal.classList.add("goal"),this.goal.style.height=`${this.drag.offsetHeight}px`)}mousemove(e){if(e.preventDefault(),this.drag&&(this.drop.classList.add("hidden"),this.elem=document.elementFromPoint(e.clientX,e.clientY),this.drop.classList.remove("hidden"),this.drop.style.left=e.pageX-this.x+"px",this.drop.style.top=e.pageY-this.y+"px",this.elem.closest(".col"))){const e=this.elem.closest(".col").querySelector("ul");e.hasChildNodes()?this.elem.closest(".add")?e.append(this.goal):this.elem.closest("h3")?e.prepend(this.goal):this.elem.closest(".task")&&e.insertBefore(this.goal,this.elem.closest(".task")):e.append(this.goal)}}mouseup(e){if(e.preventDefault(),!this.drag)return;if(!this.elem.closest(".col"))return document.querySelector(".board").removeChild(this.drop),document.querySelector(".goal").remove(),this.drag.style.opacity=100,this.drop=null,void(this.drag=null);const t=this.elem.closest(".col").querySelector("ul");this.elem.closest("h3")?t.prepend(this.drop):this.elem.closest(".add")?t.append(this.drop):t.insertBefore(this.drop,this.elem.closest("li")),document.querySelector(".goal")&&document.querySelector(".goal").remove(),this.drop.classList.remove("dragged"),this.drop.style="100%",this.drag.remove(),this.drag=null,this.drop=null}mouseleave(){this.drag&&(document.querySelector(".board").removeChild(this.drop),document.querySelector(".goal").remove(),this.drag.style.opacity=100,this.drop=null,this.drag=null)}}).init();const t=new class{constructor(e){this.storage=e}saver(e){this.storage.setItem("state",JSON.stringify(e))}loader(){try{return JSON.parse(this.storage.getItem("state"))}catch(e){throw new Error("Invalid state")}}}(localStorage);window.addEventListener("unload",(()=>{t.saver(e.save())}));const s=t.loader();e.load(s)})();